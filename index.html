<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Next Education - Personal Learning Portal</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:ital,wght@0,700;1,700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .serif { font-family: 'Playfair Display', serif; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
        
        @media print {
            body * { visibility: hidden; }
            #certificate-print-area, #certificate-print-area * { visibility: visible; }
            #certificate-print-area { position: absolute; left: 0; top: 0; width: 100%; height: 100%; display: block !important; }
            .no-print { display: none !important; }
        }

        /* Logo Shimmer Animation */
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        .shimmer-effect {
            position: relative;
            overflow: hidden;
        }
        .shimmer-effect::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0) 0%,
                rgba(255, 255, 255, 0.2) 50%,
                rgba(255, 255, 255, 0) 100%
            );
            animation: shimmer 3s infinite;
        }
    </style>
</head>
<body class="bg-slate-50 overflow-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        // --- Icons ---
        const Icon = ({ name, className = "" }) => {
            const baseClass = `w-5 h-5 ${className}`;
            const icons = {
                BookOpen: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25" /></svg>,
                ChevronRight: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" /></svg>,
                ChevronLeft: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" /></svg>,
                CheckCircle2: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg>,
                PlayCircle: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /><path strokeLinecap="round" strokeLinejoin="round" d="M15.91 11.672a.375.375 0 0 1 0 .656l-5.603 3.113a.375.375 0 0 1-.557-.328V8.887c0-.286.307-.466.557-.327l5.603 3.112Z" /></svg>,
                HelpCircle: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z" /></svg>,
                Menu: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" /></svg>,
                X: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M6 18 18 6M6 6l12 12" /></svg>,
                GraduationCap: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M4.26 10.147a60.438 60.438 0 0 0-.491 6.347A48.62 48.62 0 0 1 12 20.904a48.62 48.62 0 0 1 8.232-4.41 60.46 60.46 0 0 0-.491-6.347m-15.482 0a50.636 50.636 0 0 0-2.425 4.755l-.175.513a.412.412 0 0 0 .15.482l.334.232a48.11 48.11 0 0 1 2.116 1.44m15.482-6.982a50.636 50.636 0 0 1 2.425 4.755l.175.513a.412.412 0 0 1-.15.482l-.334.232a48.11 48.11 0 0 0-2.116 1.44m-15.482-6.982L12 5.832l8.742 4.315M12 20.904V12" /></svg>,
                Award: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M16.5 18.75h-9m9 0a3 3 0 0 1 3 3h-15a3 3 0 0 1 3-3m9 0v-3.375c0-.621-.503-1.125-1.125-1.125h-.871M7.5 18.75v-3.375c0-.621.504-1.125 1.125-1.125h.872m5.007 0V9.457c0-.621-.504-1.125-1.125-1.125h-.872M9.507 9.457V15.75m1.125-10.5a1.125 1.125 0 0 1 1.125-1.125h.872a1.125 1.125 0 0 1 1.125 1.125V9.457" /></svg>,
                Trophy: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M16.5 18.75h-9m9 0a3 3 0 0 1 3 3h-15a3 3 0 0 1 3-3m9 0v-3.375c0-.621-.503-1.125-1.125-1.125h-.871M7.5 18.75v-3.375c0-.621.504-1.125 1.125-1.125h.872m5.007 0V9.457c0-.621-.504-1.125-1.125-1.125h-.872M9.507 9.457V15.75m1.125-10.5a1.125 1.125 0 0 1 1.125-1.125h.872a1.125 1.125 0 0 1 1.125 1.125V9.457" /></svg>,
                AlertCircle: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z" /></svg>,
                Printer: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M6.72 13.89h10.56a1.92 1.92 0 0 0 1.92-1.92V7.41a1.92 1.92 0 0 0-1.92-1.92H6.72A1.92 1.92 0 0 0 4.8 7.41v4.56a1.92 1.92 0 0 0 1.92 1.92ZM4.8 17.25h14.4m-10.56-3.36V17.25m6.72-3.36V17.25" /></svg>,
                Lightbulb: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.503 7.503 0 1 0-7.516 0c.85.493 1.508 1.333 1.508 2.316V18" /></svg>,
                LogOut: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15m3 0 3-3m0 0-3-3m3 3H9" /></svg>,
                User: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" /></svg>,
                Lock: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z" /></svg>,
                Identification: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M15 9h3.75M15 12h3.75M15 15h3.75M4.5 19.5h15a2.25 2.25 0 0 0 2.25-2.25V6.75A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25v10.5A2.25 2.25 0 0 0 4.5 19.5Zm6-10.125a1.875 1.875 0 1 1-3.75 0 1.875 1.875 0 0 1 3.75 0Zm1.294 6.336a6.721 6.721 0 0 1-3.17.789 6.721 6.721 0 0 1-3.168-.789 3.376 3.376 0 0 1 6.338 0Z" /></svg>,
                Calendar: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5" /></svg>,
                UserGroup: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m.941 3.199a9.094 9.094 0 0 0-3.741-.479 3 3 0 0 0-4.682 2.72m.941 3.199a9.094 9.094 0 0 0-3.741-.479 3.001 3.001 0 0 0-4.682 2.72m.941 3.199ZM12 12a3 3 0 1 0 0-6 3 3 0 0 0 0 6Zm-7-4a3 3 0 1 1 0-6 3 3 0 0 1 0 6Zm14 0a3 3 0 1 1 0-6 3 3 0 0 1 0 6Zm14 0a3 3 0 1 1 0-6 3 3 0 0 1 0 6Z" /></svg>
            };
            return icons[name] || null;
        };

        // --- Core Data ---
        const COURSES = [
            {
                id: 'qg-101',
                title: 'Quantum Gardening',
                icon: 'Lightbulb',
                chapters: [
                    {
                        id: 'ch-1',
                        title: 'Foundations of Nano-Soil',
                        slides: [
                            { id: 's1-exp', type: 'explanation', title: 'Concept: Molecular Hydration', content: 'In quantum gardening, water is a wave-particle duality. Nano-soil uses microscopic carbon lattices to trap water in superposition, allowing roots to absorb moisture only when the wave function collapses upon observation.', image: 'https://images.unsplash.com/photo-1532187875605-2fe358a3d46a?auto=format&fit=crop&q=80&w=800' },
                            { id: 's1', type: 'mcq', title: 'Hydration Quiz', question: 'How does nano-soil maintain hydration efficiency?', options: ['Gravitational pull', 'Carbon lattices for superposition', 'Standard evaporation', 'Manual heating'], answer: 1, explanation: 'Lattices hold water in a quantum state.' },
                            { id: 's2-exp', type: 'explanation', title: 'Concept: Entangled Roots', content: 'Root systems in quantum plants can be entangled. This means a change in the nutrient intake of one plant instantly reflects in another, regardless of the physical distance between them.' },
                            { id: 's2', type: 'tf', title: 'Entanglement Study', question: 'True or False: Entangled root systems allow plants to share nutrients instantly across large distances.', answer: true, explanation: 'Quantum entanglement enables non-local transfer of biological data.' }
                        ]
                    },
                    {
                        id: 'ch-2',
                        title: 'Photosynthetic Overclocking',
                        slides: [
                            { id: 's3-exp', type: 'explanation', title: 'Concept: Gamma-Ray Synthesis', content: 'Standard plants utilize visible light. However, quantum plants are engineered to utilize high-frequency gamma rays for overclocked photosynthesis.' },
                            { id: 's3', type: 'fitb', title: 'Energy Check', question: 'Quantum plants convert high-energy _______ rays into glucose.', answer: 'gamma', explanation: 'Gamma rays provide the high energy required for quantum-level synthesis.' }
                        ]
                    }
                ]
            }
        ];

        const CLEVER_PHRASES = [
            "Close, but the universe has other plans! Try again.",
            "A glitch in the matrix? That's not quite right.",
            "Nice try, but your logic is in another dimension.",
            "Incorrect! Even Einstein had bad days. One more go?",
            "Oof, that answer just collapsed its own wave function. Try another!"
        ];

        // --- Helper Components ---
        const Certificate = ({ user, courseTitle }) => {
            const date = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            return (
                <div id="certificate-print-area" className="w-full max-w-4xl bg-white p-12 border-[16px] border-double border-slate-200 shadow-2xl text-center relative mx-auto my-8">
                    <div className="absolute inset-4 border border-slate-100 pointer-events-none"></div>
                    <div className="relative z-10">
                        <p className="text-indigo-600 font-bold tracking-widest uppercase mb-4">Certificate of Completion</p>
                        <h2 className="serif text-5xl text-slate-800 mb-8">Next Education</h2>
                        <div className="w-24 h-1 bg-indigo-600 mx-auto mb-8"></div>
                        <p className="text-xl text-slate-500 mb-2 italic">This is to certify that</p>
                        <h3 className="serif text-4xl text-slate-900 mb-8 border-b-2 border-slate-100 inline-block px-8 py-2">{user.name}</h3>
                        <p className="text-xl text-slate-500 mb-2 italic">has successfully completed the course</p>
                        <h4 className="text-3xl font-bold text-indigo-700 mb-12">{courseTitle}</h4>
                        <div className="flex justify-between items-end mt-16 px-12">
                            <div className="text-center">
                                <div className="serif text-xl border-b border-slate-300 px-4 mb-1">Mrs. Huma Sarfraz</div>
                                <div className="text-xs text-slate-400 uppercase tracking-widest">Academic Director</div>
                            </div>
                            <div className="text-center">
                                <div className="serif text-xl border-b border-slate-300 px-4 mb-1">{date}</div>
                                <div className="text-xs text-slate-400 uppercase tracking-widest">Issue Date</div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Main App ---
        function App() {
            // User & Auth State
            const [currentUser, setCurrentUser] = useState(null);
            const [users, setUsers] = useState(() => JSON.parse(localStorage.getItem('next_edu_users') || '[]'));
            const [authTab, setAuthTab] = useState('login');
            const [view, setView] = useState('auth'); // 'auth', 'welcome', 'platform'
            
            // App Navigation State
            const [currentCourseId, setCurrentCourseId] = useState(COURSES[0].id);
            const [currentChapterIdx, setCurrentChapterIdx] = useState(0);
            const [currentSlideIdx, setCurrentSlideIdx] = useState(0);
            const [isSidebarOpen, setIsSidebarOpen] = useState(true);
            const [popup, setPopup] = useState({ show: false, message: '' });
            const [phraseIdx, setPhraseIdx] = useState(0);
            const [courseCompleted, setCourseCompleted] = useState(false);
            const [showCertificate, setShowCertificate] = useState(false);

            // Form States
            const [formData, setFormData] = useState({ username: '', password: '', name: '', age: '', gender: 'other' });
            const [loginData, setLoginData] = useState({ username: '', password: '' });
            const [loginError, setLoginError] = useState(false);

            // Persist Users
            useEffect(() => {
                localStorage.setItem('next_edu_users', JSON.stringify(users));
            }, [users]);

            // Check if user is already logged in
            useEffect(() => {
                const active = localStorage.getItem('next_edu_active_user');
                if (active) {
                    const found = users.find(u => u.username === active);
                    if (found) {
                        setCurrentUser(found);
                        setView('welcome');
                    }
                }
            }, []);

            const currentCourse = COURSES.find(c => c.id === currentCourseId);
            const currentChapter = currentCourse.chapters[currentChapterIdx];
            const currentSlide = currentChapter ? currentChapter.slides[currentSlideIdx] : null;

            // Derived Progress Logic
            const userProgress = currentUser?.progress?.[currentCourseId] || [];
            
            const isSlideCleared = (slideId) => userProgress.includes(slideId);
            
            const isCurrentSlideCleared = useMemo(() => {
                if (!currentSlide) return true;
                if (currentSlide.type === 'explanation') return true;
                return isSlideCleared(currentSlide.id);
            }, [currentSlide, userProgress]);

            // Gated Sidebar Logic
            const isSlideUnlocked = (chapIdx, slideIdx) => {
                if (chapIdx === 0 && slideIdx === 0) return true;
                
                let prevChapIdx = chapIdx;
                let prevSlideIdx = slideIdx - 1;
                
                if (prevSlideIdx < 0) {
                    prevChapIdx = chapIdx - 1;
                    if (prevChapIdx < 0) return true;
                    prevSlideIdx = currentCourse.chapters[prevChapIdx].slides.length - 1;
                }
                
                const prevSlide = currentCourse.chapters[prevChapIdx].slides[prevSlideIdx];
                return prevSlide.type === 'explanation' || isSlideCleared(prevSlide.id);
            };

            const triggerPopup = (msg) => {
                setPopup({ show: true, message: msg });
                setTimeout(() => setPopup({ show: false, message: '' }), 3000);
            };

            // Auth Handlers
            const handleRegister = (e) => {
                e.preventDefault();
                if (users.some(u => u.username === formData.username)) {
                    triggerPopup("Username already exists!");
                    return;
                }
                const newUser = { ...formData, progress: {} };
                const newUsersList = [...users, newUser];
                setUsers(newUsersList);
                setCurrentUser(newUser);
                localStorage.setItem('next_edu_active_user', formData.username);
                setView('welcome');
            };

            const handleLogin = (e) => {
                e.preventDefault();
                const found = users.find(u => u.username === loginData.username && u.password === loginData.password);
                if (found) {
                    setLoginError(false);
                    setCurrentUser(found);
                    localStorage.setItem('next_edu_active_user', found.username);
                    setView('welcome');
                } else {
                    setLoginError(true);
                    triggerPopup("Invalid credentials.");
                }
            };

            const handleLogout = () => {
                localStorage.removeItem('next_edu_active_user');
                setCurrentUser(null);
                setView('auth');
                setLoginData({ username: '', password: '' });
                setLoginError(false);
            };

            // Reset error when switching tabs
            useEffect(() => {
                setLoginError(false);
            }, [authTab]);

            // Platform Handlers
            const handleNext = () => {
                if (!isCurrentSlideCleared) {
                    triggerPopup("Finish the concept or answer the question correctly to proceed!");
                    return;
                }
                const isLastSlide = currentSlideIdx === currentChapter.slides.length - 1;
                const isLastChapter = currentChapterIdx === currentCourse.chapters.length - 1;
                
                if (isLastSlide && isLastChapter) {
                    setCourseCompleted(true);
                } else if (isLastSlide) {
                    setCurrentChapterIdx(prev => prev + 1);
                    setCurrentSlideIdx(0);
                } else {
                    setCurrentSlideIdx(prev => prev + 1);
                }
            };

            const handlePrev = () => {
                if (courseCompleted) { setCourseCompleted(false); setShowCertificate(false); return; }
                if (currentSlideIdx > 0) { setCurrentSlideIdx(prev => prev - 1); }
                else if (currentChapterIdx > 0) {
                    const prevChapterIdx = currentChapterIdx - 1;
                    setCurrentChapterIdx(prevChapterIdx);
                    setCurrentSlideIdx(currentCourse.chapters[prevChapterIdx].slides.length - 1);
                }
            };

            const selectTopic = (cIdx, sIdx) => {
                if (!isSlideUnlocked(cIdx, sIdx)) {
                    triggerPopup("Please complete previous topics first!");
                    return;
                }
                setCourseCompleted(false);
                setShowCertificate(false);
                setCurrentChapterIdx(cIdx);
                setCurrentSlideIdx(sIdx);
            };

            const handleAnswerCheck = (val) => {
                const isCorrect = currentSlide.type === 'fitb'
                    ? val?.toLowerCase().trim() === currentSlide.answer.toLowerCase()
                    : val === currentSlide.answer;

                if (isCorrect) {
                    const newUsers = users.map(u => {
                        if (u.username === currentUser.username) {
                            const currentProgress = u.progress[currentCourseId] || [];
                            if (!currentProgress.includes(currentSlide.id)) {
                                return { ...u, progress: { ...u.progress, [currentCourseId]: [...currentProgress, currentSlide.id] } };
                            }
                        }
                        return u;
                    });
                    setUsers(newUsers);
                    setCurrentUser(newUsers.find(u => u.username === currentUser.username));
                } else {
                    triggerPopup(CLEVER_PHRASES[phraseIdx]);
                    setPhraseIdx(prev => (prev + 1) % CLEVER_PHRASES.length);
                }
            };

            if (view === 'auth') {
                return (
                    <div className="h-screen w-full flex items-center justify-center bg-slate-900 p-6 overflow-y-auto">
                        <div className="max-w-md w-full bg-white rounded-[32px] overflow-hidden shadow-2xl">
                            <div className="flex bg-slate-100 p-2">
                                <button onClick={() => setAuthTab('login')} className={`flex-1 py-3 rounded-2xl font-bold transition-all ${authTab === 'login' ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-400'}`}>Login</button>
                                <button onClick={() => setAuthTab('register')} className={`flex-1 py-3 rounded-2xl font-bold transition-all ${authTab === 'register' ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-400'}`}>Register</button>
                            </div>
                            
                            <div className="p-8">
                                <div className="flex justify-center mb-6">
                                    <div className="relative group">
                                        <div className="absolute -inset-1 bg-gradient-to-r from-indigo-600 to-violet-600 rounded-2xl blur opacity-25 group-hover:opacity-50 transition duration-1000 group-hover:duration-200"></div>
                                        <div className="relative bg-gradient-to-br from-indigo-600 to-indigo-700 p-4 rounded-2xl text-white shadow-2xl border border-white/20 shimmer-effect">
                                            <Icon name="BookOpen" className="!w-10 !h-10" />
                                        </div>
                                    </div>
                                </div>
                                <h1 className="text-2xl font-extrabold text-slate-900 text-center mb-2">{authTab === 'login' ? 'Welcome Back' : 'Join Next Education'}</h1>
                                <p className="text-slate-400 text-center text-sm mb-8 font-medium tracking-tight">Your gateway to the future of learning</p>
                                
                                {authTab === 'login' ? (
                                    <form onSubmit={handleLogin} className="space-y-4">
                                        <div className="relative">
                                            <Icon name="User" className={`absolute left-4 top-1/2 -translate-y-1/2 transition-colors ${loginError ? 'text-rose-400' : 'text-slate-400'}`} />
                                            <input 
                                                type="text" 
                                                placeholder="Username" 
                                                required 
                                                className={`w-full pl-12 pr-4 py-4 border rounded-2xl outline-none transition-all ${loginError ? 'bg-rose-50 border-rose-500 text-rose-900 placeholder-rose-300' : 'bg-slate-50 border-slate-100 text-slate-900 focus:border-indigo-500'}`} 
                                                value={loginData.username} 
                                                onChange={(e) => {
                                                    setLoginData({...loginData, username: e.target.value});
                                                    setLoginError(false);
                                                }} 
                                            />
                                        </div>
                                        <div className="relative">
                                            <Icon name="Lock" className={`absolute left-4 top-1/2 -translate-y-1/2 transition-colors ${loginError ? 'text-rose-400' : 'text-slate-400'}`} />
                                            <input 
                                                type="password" 
                                                placeholder="Password" 
                                                required 
                                                className={`w-full pl-12 pr-4 py-4 border rounded-2xl outline-none transition-all ${loginError ? 'bg-rose-50 border-rose-500 text-rose-900 placeholder-rose-300' : 'bg-slate-50 border-slate-100 text-slate-900 focus:border-indigo-500'}`} 
                                                value={loginData.password} 
                                                onChange={(e) => {
                                                    setLoginData({...loginData, password: e.target.value});
                                                    setLoginError(false);
                                                }} 
                                            />
                                        </div>
                                        <button className="w-full bg-indigo-600 text-white py-4 rounded-2xl font-bold shadow-xl shadow-indigo-100 hover:bg-indigo-700 transition-all mt-4">Sign In</button>
                                        
                                        {loginError && (
                                            <div className="mt-4 text-rose-500 text-xs font-bold text-center animate-in fade-in slide-in-from-top-1 duration-200">
                                                Incorrect username or password. Please try again.
                                            </div>
                                        )}
                                    </form>
                                ) : (
                                    <form onSubmit={handleRegister} className="space-y-4">
                                        <div className="relative">
                                            <Icon name="Identification" className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" />
                                            <input type="text" placeholder="Full Name" required className="w-full pl-12 pr-4 py-3 bg-slate-50 border border-slate-100 rounded-xl outline-none focus:border-indigo-500 transition-all" value={formData.name} onChange={(e) => setFormData({...formData, name: e.target.value})} />
                                        </div>
                                        <div className="flex gap-4">
                                            <div className="relative w-24">
                                                <Icon name="Calendar" className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" />
                                                <input type="number" placeholder="Age" required className="w-full pl-11 pr-2 py-3 bg-slate-50 border border-slate-100 rounded-xl outline-none focus:border-indigo-500 transition-all" value={formData.age} onChange={(e) => setFormData({...formData, age: e.target.value})} />
                                            </div>
                                            <div className="relative flex-1">
                                                <Icon name="UserGroup" className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" />
                                                <select className="w-full pl-11 pr-4 py-3 bg-slate-50 border border-slate-100 rounded-xl outline-none focus:border-indigo-500 transition-all appearance-none" value={formData.gender} onChange={(e) => setFormData({...formData, gender: e.target.value})}>
                                                    <option value="male">Male</option>
                                                    <option value="female">Female</option>
                                                    <option value="other">Other</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div className="relative">
                                            <Icon name="User" className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" />
                                            <input type="text" placeholder="Choose Username" required className="w-full pl-12 pr-4 py-3 bg-slate-50 border border-slate-100 rounded-xl outline-none focus:border-indigo-500 transition-all" value={formData.username} onChange={(e) => setFormData({...formData, username: e.target.value})} />
                                        </div>
                                        <div className="relative">
                                            <Icon name="Lock" className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" />
                                            <input type="password" placeholder="Set Password" required className="w-full pl-12 pr-4 py-3 bg-slate-50 border border-slate-100 rounded-xl outline-none focus:border-indigo-500 transition-all" value={formData.password} onChange={(e) => setFormData({...formData, password: e.target.value})} />
                                        </div>
                                        <button className="w-full bg-indigo-600 text-white py-4 rounded-2xl font-bold hover:bg-indigo-700 transition-all mt-4">Create Account</button>
                                    </form>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            if (view === 'welcome') {
                return (
                    <div className="h-screen w-full flex items-center justify-center bg-slate-50 p-6">
                        <div className="max-w-2xl w-full bg-white rounded-[40px] p-12 shadow-2xl text-center border border-slate-100 animate-in fade-in zoom-in-95 duration-500">
                            <div className="relative inline-block mb-8">
                                <img src={`https://ui-avatars.com/api/?name=${currentUser.name}&background=4F46E5&color=fff&size=128`} className="w-32 h-32 rounded-full border-4 border-white shadow-xl" alt="Profile" />
                                <div className="absolute bottom-2 right-2 bg-emerald-500 w-6 h-6 rounded-full border-4 border-white"></div>
                            </div>
                            <h2 className="text-4xl font-extrabold text-slate-900 mb-2">Welcome back, {currentUser.name}</h2>
                            <p className="text-indigo-600 font-medium mb-10">@{currentUser.username} • {currentUser.age} yrs • {currentUser.gender}</p>
                            <div className="grid grid-cols-2 gap-4 mb-10">
                                <div className="bg-slate-50 p-6 rounded-3xl border border-slate-100">
                                    <div className="text-2xl font-bold text-slate-900">{userProgress.length}</div>
                                    <div className="text-xs font-bold text-slate-400 uppercase tracking-widest mt-1">Concepts Mastered</div>
                                </div>
                                <div className="bg-slate-50 p-6 rounded-3xl border border-slate-100">
                                    <div className="text-2xl font-bold text-slate-900">{COURSES.length}</div>
                                    <div className="text-xs font-bold text-slate-400 uppercase tracking-widest mt-1">Active Courses</div>
                                </div>
                            </div>
                            <div className="flex gap-4">
                                <button onClick={() => setView('platform')} className="flex-1 bg-indigo-600 text-white px-8 py-5 rounded-3xl font-bold hover:bg-indigo-700 transition-all shadow-xl shadow-indigo-200">Start Learning</button>
                                <button onClick={handleLogout} className="bg-slate-100 text-slate-600 px-6 py-5 rounded-3xl font-bold hover:bg-slate-200 transition-all">Change User</button>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="flex h-screen bg-slate-50 text-slate-900 overflow-hidden">
                    {popup.show && (
                        <div className="fixed top-20 left-1/2 -translate-x-1/2 z-[100] animate-in slide-in-from-top-4">
                            <div className="bg-slate-900 text-white px-6 py-4 rounded-2xl shadow-2xl flex items-center gap-3 min-w-[300px]">
                                <div className="bg-rose-500 p-1.5 rounded-full"><Icon name="AlertCircle" className="w-4 h-4 text-white" /></div>
                                <p className="font-medium text-sm">{popup.message}</p>
                            </div>
                        </div>
                    )}

                    <aside className="no-print bg-slate-900 text-white transition-all duration-300 flex flex-col w-64">
                        <div className="p-6 border-b border-slate-800 flex items-center gap-3">
                            <div className="bg-indigo-600 p-2 rounded-lg"><Icon name="BookOpen" className="w-6 h-6" /></div>
                            <h1 className="font-bold text-xl tracking-tight">Next Education</h1>
                        </div>
                        <nav className="flex-1 py-4 overflow-y-auto custom-scrollbar">
                            <div className="px-4 mb-2 text-xs font-semibold text-slate-500 uppercase tracking-wider">Courses</div>
                            {COURSES.map(course => (
                                <button key={course.id} onClick={() => { setCurrentCourseId(course.id); setCurrentChapterIdx(0); setCurrentSlideIdx(0); setCourseCompleted(false); }} className={`w-full flex items-center gap-3 px-6 py-3 transition-colors ${currentCourseId === course.id ? 'bg-indigo-600 text-white' : 'hover:bg-slate-800 text-slate-400'}`}>
                                    <Icon name={course.icon} />
                                    <span className="text-sm font-medium">{course.title}</span>
                                </button>
                            ))}
                        </nav>
                        <div className="p-4 border-t border-slate-800">
                            <div className="flex flex-col gap-2">
                                <button onClick={() => setView('welcome')} className="flex items-center gap-3 p-3 bg-slate-800 rounded-xl">
                                    <img src={`https://ui-avatars.com/api/?name=${currentUser.name}&background=4F46E5&color=fff&size=32`} className="w-8 h-8 rounded-full" />
                                    <div className="flex-1 overflow-hidden text-left">
                                        <p className="text-xs font-medium truncate">{currentUser.name}</p>
                                        <p className="text-[10px] text-slate-400">View Profile</p>
                                    </div>
                                </button>
                                <button onClick={handleLogout} className="flex items-center gap-3 p-3 text-rose-400 hover:bg-rose-500/10 rounded-xl transition-all">
                                    <Icon name="LogOut" className="w-4 h-4" />
                                    <span className="text-xs font-bold uppercase">Change User</span>
                                </button>
                            </div>
                        </div>
                    </aside>

                    <main className="flex-1 flex flex-col bg-white">
                        <header className="no-print h-16 border-b flex items-center px-6 bg-white/80 backdrop-blur-md sticky top-0 z-10">
                            <div className="flex items-center gap-2 text-sm">
                                <span className="text-slate-400">{currentCourse.title}</span>
                                {!courseCompleted && <><Icon name="ChevronRight" className="w-4 h-4 text-slate-300" /><span className="font-semibold">{currentChapter.title}</span></>}
                            </div>
                        </header>

                        <div className="flex-1 overflow-y-auto p-8 custom-scrollbar">
                            {courseCompleted ? (
                                <div className="max-w-4xl mx-auto text-center">
                                    {!showCertificate ? (
                                        <div className="bg-slate-50 p-12 rounded-[40px] border-2 border-dashed border-indigo-200 animate-in zoom-in-95">
                                            <div className="w-24 h-24 bg-yellow-400 text-white rounded-full flex items-center justify-center mx-auto mb-6 shadow-xl animate-bounce"><Icon name="Trophy" className="w-12 h-12" /></div>
                                            <h2 className="serif text-5xl text-slate-900 mb-4">Course Complete!</h2>
                                            <p className="text-xl text-slate-600 mb-8">Well done, {currentUser.name}! You have mastered all topics.</p>
                                            <div className="flex gap-4 justify-center">
                                                <button onClick={() => setShowCertificate(true)} className="bg-indigo-600 text-white px-8 py-4 rounded-2xl font-bold shadow-lg hover:bg-indigo-700">View Certificate</button>
                                                <button onClick={() => {setCourseCompleted(false); setCurrentChapterIdx(0); setCurrentSlideIdx(0);}} className="bg-white border-2 border-slate-200 px-8 py-4 rounded-2xl font-bold hover:bg-slate-50">Review Lessons</button>
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="animate-in fade-in slide-in-from-bottom-8">
                                            <Certificate user={currentUser} courseTitle={currentCourse.title} />
                                            <div className="no-print mt-8 flex justify-center gap-4">
                                                <button onClick={() => window.print()} className="bg-slate-900 text-white px-8 py-3 rounded-xl font-bold flex items-center gap-2 hover:bg-slate-800"><Icon name="Printer" /> Print</button>
                                                <button onClick={() => setShowCertificate(false)} className="text-slate-500 font-bold px-6 py-3">Back</button>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            ) : (
                                <div className="max-w-3xl mx-auto">
                                    <div className="mb-8">
                                        <span className="inline-block px-3 py-1 bg-slate-100 text-slate-600 rounded text-xs font-bold uppercase tracking-widest mb-4">{currentSlide.type === 'explanation' ? 'Learning Concept' : 'Knowledge Check'}</span>
                                        <h2 className="text-3xl font-extrabold text-slate-900 leading-tight">{currentSlide.title}</h2>
                                    </div>

                                    {currentSlide.type === 'explanation' ? (
                                        <div className="space-y-6 text-slate-700 text-lg leading-relaxed animate-in fade-in duration-500">
                                            <p>{currentSlide.content}</p>
                                            {currentSlide.image && <div className="rounded-2xl overflow-hidden shadow-2xl my-8 border-4 border-white"><img src={currentSlide.image} alt="Topic" className="w-full h-auto object-cover max-h-[400px]" /></div>}
                                            <div className="bg-indigo-50 p-6 rounded-2xl border-l-4 border-indigo-600"><p className="text-indigo-900 italic font-medium">Concept learned! You can now proceed to the quiz.</p></div>
                                        </div>
                                    ) : (
                                        <div className="bg-slate-50 border border-slate-200 p-8 rounded-3xl shadow-sm">
                                            <h3 className="text-xl font-bold mb-6 text-slate-800">{currentSlide.question}</h3>
                                            
                                            {currentSlide.type === 'mcq' && (
                                                <div className="space-y-3">
                                                    {currentSlide.options.map((opt, idx) => (
                                                        <button key={idx} disabled={isSlideCleared(currentSlide.id)} onClick={() => handleAnswerCheck(idx)} className={`w-full text-left p-4 rounded-xl border-2 transition-all flex items-center justify-between ${isSlideCleared(currentSlide.id) && idx === currentSlide.answer ? 'border-emerald-500 bg-emerald-50 text-emerald-800' : 'border-white bg-white hover:border-slate-200'}`}>
                                                            <span className="font-medium">{opt}</span>
                                                            {isSlideCleared(currentSlide.id) && idx === currentSlide.answer && <Icon name="CheckCircle2" className="text-emerald-500" />}
                                                        </button>
                                                    ))}
                                                </div>
                                            )}

                                            {currentSlide.type === 'tf' && (
                                                <div className="flex gap-4">
                                                    {[true, false].map((val) => (
                                                        <button key={val.toString()} disabled={isSlideCleared(currentSlide.id)} onClick={() => handleAnswerCheck(val)} className={`flex-1 p-6 rounded-2xl border-2 font-bold transition-all ${isSlideCleared(currentSlide.id) && val === currentSlide.answer ? 'border-emerald-500 bg-emerald-50 text-emerald-700' : 'border-white bg-white hover:border-slate-200'}`}>{val ? 'TRUE' : 'FALSE'}</button>
                                                    ))}
                                                </div>
                                            )}

                                            {currentSlide.type === 'fitb' && (
                                                <input type="text" placeholder="Type answer..." disabled={isSlideCleared(currentSlide.id)} className={`w-full p-4 rounded-xl border-2 outline-none font-medium ${isSlideCleared(currentSlide.id) ? 'border-emerald-500 bg-emerald-50' : 'border-slate-200 focus:border-indigo-500'}`} onKeyDown={(e) => e.key === 'Enter' && handleAnswerCheck(e.target.value)} />
                                            )}

                                            {isSlideCleared(currentSlide.id) && (
                                                <div className="mt-8 p-6 rounded-2xl bg-emerald-50 text-emerald-800 border border-emerald-100 animate-in zoom-in-95">
                                                    <div className="flex items-center gap-2 font-bold mb-2"><Icon name="Award" /> Concept Mastered!</div>
                                                    <p className="text-sm opacity-90">{currentSlide.explanation}</p>
                                                </div>
                                            )}
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>

                        <footer className="no-print h-20 border-t bg-white px-8 flex items-center justify-between sticky bottom-0 z-10">
                            <button onClick={handlePrev} className="flex items-center gap-2 text-slate-600 hover:text-indigo-600 font-semibold disabled:opacity-30" disabled={currentChapterIdx === 0 && currentSlideIdx === 0 && !courseCompleted}><Icon name="ChevronLeft" /> Previous</button>
                            <div className="flex items-center gap-1">{!courseCompleted && currentChapter.slides.map((_, idx) => <div key={idx} className={`h-1.5 rounded-full transition-all duration-300 ${idx === currentSlideIdx ? 'w-8 bg-indigo-600' : 'w-2 bg-slate-200'}`} />)}</div>
                            {!courseCompleted && (
                                <button onClick={handleNext} className={`flex items-center gap-2 px-6 py-2.5 rounded-xl font-bold transition-all ${isCurrentSlideCleared ? 'bg-indigo-600 text-white hover:bg-indigo-700' : 'bg-slate-100 text-slate-400 cursor-not-allowed'}`}>
                                    {(currentSlideIdx === currentChapter.slides.length - 1 && currentChapterIdx === currentCourse.chapters.length - 1) ? 'Finish Course' : 'Next'} <Icon name="ChevronRight" />
                                </button>
                            )}
                        </footer>
                    </main>

                    <aside className="no-print w-80 bg-white border-l flex flex-col">
                        <div className="p-6 border-b"><h3 className="font-bold text-slate-900 flex items-center gap-2"><Icon name="BookOpen" className="text-indigo-600" /> Syllabus</h3></div>
                        <div className="flex-1 overflow-y-auto p-4 space-y-6 custom-scrollbar">
                            {currentCourse.chapters.map((chapter, cIdx) => (
                                <div key={chapter.id} className="space-y-2">
                                    <div className="flex items-center gap-2 text-xs font-bold text-slate-400 uppercase tracking-widest px-2">Chapter {cIdx + 1}</div>
                                    <div className="font-bold text-slate-800 px-2 py-1">{chapter.title}</div>
                                    <div className="space-y-1 relative before:absolute before:left-4 before:top-2 before:bottom-2 before:w-[2px] before:bg-slate-100">
                                        {chapter.slides.map((slide, sIdx) => {
                                            const isActive = !courseCompleted && currentChapterIdx === cIdx && currentSlideIdx === sIdx;
                                            const isDone = isSlideCleared(slide.id) || slide.type === 'explanation';
                                            const unlocked = isSlideUnlocked(cIdx, sIdx);
                                            return (
                                                <button key={slide.id} onClick={() => selectTopic(cIdx, sIdx)} className={`w-full flex items-start gap-3 p-2.5 rounded-lg transition-all text-left relative z-10 ${isActive ? 'bg-indigo-50' : 'hover:bg-slate-50'} ${!unlocked ? 'opacity-40 grayscale cursor-not-allowed' : ''}`}>
                                                    <div className={`mt-1 flex-shrink-0 ${isActive ? 'text-indigo-600' : isDone ? 'text-emerald-500' : 'text-slate-300'}`}>
                                                        {isDone ? <Icon name="CheckCircle2" className="w-4 h-4" /> : <Icon name="PlayCircle" className="w-4 h-4" />}
                                                    </div>
                                                    <div className="flex flex-col overflow-hidden">
                                                        <span className={`text-sm font-medium leading-tight truncate ${isActive ? 'text-indigo-700 font-bold' : 'text-slate-600'}`}>{slide.title}</span>
                                                    </div>
                                                </button>
                                            );
                                        })}
                                    </div>
                                </div>
                            ))}
                        </div>
                    </aside>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
