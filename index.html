<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Next Education - Personal Learning Portal</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:ital,wght@0,700;1,700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .serif { font-family: 'Playfair Display', serif; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
        
        @media print {
            body * { visibility: hidden; }
            #certificate-print-area, #certificate-print-area * { visibility: visible; }
            #certificate-print-area { position: absolute; left: 0; top: 0; width: 100%; height: 100%; display: block !important; }
            .no-print { display: none !important; }
        }

        /* Logo Shimmer Animation */
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        .shimmer-effect {
            position: relative;
            overflow: hidden;
        }
        .shimmer-effect::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0) 0%,
                rgba(255, 255, 255, 0.2) 50%,
                rgba(255, 255, 255, 0) 100%
            );
            animation: shimmer 3s infinite;
        }
    </style>
</head>
<body class="bg-slate-50 overflow-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        // --- Icons ---
        const Icon = ({ name, className = "" }) => {
            const baseClass = `w-5 h-5 ${className}`;
            const icons = {
                BookOpen: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25" /></svg>,
                ChevronRight: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" /></svg>,
                ChevronLeft: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" /></svg>,
                CheckCircle2: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg>,
                PlayCircle: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /><path strokeLinecap="round" strokeLinejoin="round" d="M15.91 11.672a.375.375 0 0 1 0 .656l-5.603 3.113a.375.375 0 0 1-.557-.328V8.887c0-.286.307-.466.557-.327l5.603 3.112Z" /></svg>,
                HelpCircle: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z" /></svg>,
                X: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M6 18 18 6M6 6l12 12" /></svg>,
                Award: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M16.5 18.75h-9m9 0a3 3 0 0 1 3 3h-15a3 3 0 0 1 3-3m9 0v-3.375c0-.621-.503-1.125-1.125-1.125h-.871M7.5 18.75v-3.375c0-.621.504-1.125 1.125-1.125h.872m5.007 0V9.457c0-.621-.504-1.125-1.125-1.125h-.872M9.507 9.457V15.75m1.125-10.5a1.125 1.125 0 0 1 1.125-1.125h.872a1.125 1.125 0 0 1 1.125 1.125V9.457" /></svg>,
                Trophy: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M16.5 18.75h-9m9 0a3 3 0 0 1 3 3h-15a3 3 0 0 1 3-3m9 0v-3.375c0-.621-.503-1.125-1.125-1.125h-.871M7.5 18.75v-3.375c0-.621.504-1.125 1.125-1.125h.872m5.007 0V9.457c0-.621-.504-1.125-1.125-1.125h-.872M9.507 9.457V15.75m1.125-10.5a1.125 1.125 0 0 1 1.125-1.125h.872a1.125 1.125 0 0 1 1.125 1.125V9.457" /></svg>,
                AlertCircle: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z" /></svg>,
                Printer: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M6.72 13.89h10.56a1.92 1.92 0 0 0 1.92-1.92V7.41a1.92 1.92 0 0 0-1.92-1.92H6.72A1.92 1.92 0 0 0 4.8 7.41v4.56a1.92 1.92 0 0 0 1.92 1.92ZM4.8 17.25h14.4m-10.56-3.36V17.25m6.72-3.36V17.25" /></svg>,
                Lightbulb: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.383a14.406 14.406 0 0 1-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.503 7.503 0 1 0-7.516 0c.85.493 1.508 1.333 1.508 2.316V18" /></svg>,
                LogOut: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15m3 0 3-3m0 0-3-3m3 3H9" /></svg>,
                User: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" /></svg>,
                Lock: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z" /></svg>,
                Identification: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M15 9h3.75M15 12h3.75M15 15h3.75M4.5 19.5h15a2.25 2.25 0 0 0 2.25-2.25V6.75A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25v10.5A2.25 2.25 0 0 0 4.5 19.5Zm6-10.125a1.875 1.875 0 1 1-3.75 0 1.875 1.875 0 0 1 3.75 0Zm1.294 6.336a6.721 6.721 0 0 1-3.17.789 6.721 6.721 0 0 1-3.168-.789 3.376 3.376 0 0 1 6.338 0Z" /></svg>,
                Calendar: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5" /></svg>,
                UserGroup: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m.941 3.199a9.094 9.094 0 0 0-3.741-.479 3 3 0 0 0-4.682 2.72m.941 3.199a9.094 9.094 0 0 0-3.741-.479 3.001 3.001 0 0 0-4.682 2.72m.941 3.199ZM12 12a3 3 0 1 0 0-6 3 3 0 0 0 0 6Zm-7-4a3 3 0 1 1 0-6 3 3 0 0 1 0 6Zm14 0a3 3 0 1 1 0-6 3 3 0 0 1 0 6Zm14 0a3 3 0 1 1 0-6 3 3 0 0 1 0 6Z" /></svg>,
                Globe: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M12 21a9.004 9.004 0 0 0 8.716-6.747M12 21a9.004 9.004 0 0 1-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9s2.015-9 4.5-9m0 18c-5.965 0-10.8-4.03-10.8-9s4.835-9 10.8-9m0 18c5.965 0 10.8-4.03 10.8-9s-4.835-9-10.8-9" /></svg>,
                Fingerprint: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M7.864 4.243A7.5 7.5 0 0 1 19.5 10.5c0 2.92-.556 5.709-1.568 8.263M14.89 4.043A7.501 7.501 0 0 0 4.5 10.5c0 1.97.541 3.815 1.48 5.394M9 21h6M12 15c-1.105 0-2 .895-2 2s.895 2 2 2 2-.895 2-2-.895-2-2-2Z" /></svg>,
                Leaf: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M12 21a9.004 9.004 0 0 0 8.716-6.747M12 21a9.004 9.004 0 0 1-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9s2.015-9 4.5-9m0 18c-5.965 0-10.8-4.03-10.8-9s4.835-9 10.8-9m0 18c5.965 0 10.8-4.03 10.8-9s-4.835-9-10.8-9" /></svg>,
                Cpu: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M8.25 3v1.5M4.5 8.25H3m18 0h-1.5m-15 7.5H3m18 0h-1.5m-15 3.75V21m11.25-18v1.5m0 15V21M4.75 4.75l1.06 1.06m12.38 12.38l1.06 1.06m0-13.44l-1.06 1.06m-12.38 12.38l-1.06 1.06M8.25 7.5V16.5M16.5 8.25H7.5" /></svg>,
                MenuAlt2: <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={baseClass}><path strokeLinecap="round" strokeLinejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5M12 17.25h8.25" /></svg>,
            };
            return icons[name] || null;
        };

        // --- Site Logo Component ---
        const SiteLogo = ({ className = "w-10 h-10" }) => (
            <img 
                src="image_3f1e3e.png" 
                alt="Next Education Logo" 
                className={`${className} object-contain`}
                onError={(e) => {
                    e.target.onerror = null;
                    e.target.src = 'https://via.placeholder.com/150?text=Next+Education';
                }}
            />
        );

        // --- Core Data ---
        const COURSES = [
            {
                id: 'qg-101',
                title: 'Quantum Gardening',
                icon: 'Lightbulb',
                chapters: [
                    { id: 'qg-c1', title: 'Nano-Botany Basics', slides: [
                        { id: 'qg1e', type: 'explanation', title: 'Molecular Hydration', content: 'Nano-soil uses carbon lattices to trap water in superposition.' },
                        { id: 'qg1q', type: 'mcq', title: 'Hydration Quiz', question: 'What traps water?', options: ['Sand', 'Lattices', 'Clay', 'Ice'], answer: 1, explanation: 'Carbon lattices are used.' },
                        { id: 'qg2e', type: 'explanation', title: 'Entangled Roots', content: 'Plants share nutrients instantly via entanglement.' },
                        { id: 'qg2q', type: 'tf', title: 'Entanglement Quiz', question: 'Roots can share nutrients instantly.', answer: true, explanation: 'Yes, via quantum links.' },
                        { id: 'qg3e', type: 'explanation', title: 'Growth Superposition', content: 'Plants exist in multiple heights until observed.' },
                        { id: 'qg3q', type: 'fitb', title: 'Superposition Quiz', question: 'Growth is fixed upon _______.', answer: 'observation', explanation: 'Observing collapses the wave function.' },
                        { id: 'qg4e', type: 'explanation', title: 'Botanical Wave Functions', content: 'Every plant has a unique wave signature.' },
                        { id: 'qg4q', type: 'mcq', title: 'Wave Quiz', question: 'What signature does every plant have?', options: ['ID card', 'Wave function', 'DNA', 'Passport'], answer: 1, explanation: 'It is a quantum wave function.' },
                        { id: 'qg5e', type: 'explanation', title: 'Subatomic Pruning', content: 'Trimming branches at the particle level.' },
                        { id: 'qg5q', type: 'tf', title: 'Pruning Quiz', question: 'Pruning is done with scissors.', answer: false, explanation: 'It is subatomic.' }
                    ]},
                    { id: 'qg-c2', title: 'Photosynthetic Efficiency', slides: [
                        { id: 'qg_s6e', type: 'explanation', title: 'Exciton Paths', content: 'Excitons find the fastest path to the reaction center.' },
                        { id: 'qg_s6q', type: 'mcq', title: 'Path Quiz', question: 'Excitons find the _______ path.', options: ['Longest', 'Fastest', 'Slowest', 'Random'], answer: 1, explanation: 'They explore all paths.' },
                        { id: 'qg_s7e', type: 'explanation', title: 'Gamma Synthesis', content: 'Plants engineered to process high-energy gamma rays.' },
                        { id: 'qg_s7q', type: 'fitb', title: 'Gamma Quiz', question: 'Plants process _______ rays.', answer: 'gamma', explanation: 'Gamma rays provide high energy.' },
                        { id: 'qg_s8e', type: 'explanation', title: 'Quantum Tunneling', content: 'Electrons bypass biological barriers via tunneling.' },
                        { id: 'qg_s8q', type: 'tf', title: 'Tunneling Quiz', question: 'Tunneling bypasses barriers.', answer: true, explanation: 'Yes, it is a quantum shortcut.' },
                        { id: 'qg_s9e', type: 'explanation', title: 'Chlorophyll Overclocking', content: 'Increasing conversion rates to 99%.' },
                        { id: 'qg_s9q', type: 'mcq', title: 'Conversion Quiz', question: 'What is the overclocked rate?', options: ['10%', '50%', '99%', '100%'], answer: 2, explanation: '99% is the limit.' },
                        { id: 'qg_s10e', type: 'explanation', title: 'Dark Reaction Spikes', content: 'Enzymatic speed-ups during the dark cycle.' },
                        { id: 'qg_s10q', type: 'fitb', title: 'Dark Quiz', question: 'Speed-ups happen in the _______ cycle.', answer: 'dark', explanation: 'It occurs during dark reactions.' }
                    ]},
                    { id: 'qg-c3', title: 'Advanced Ecosystems', slides: [
                        { id: 'qg_s11e', type: 'explanation', title: 'Chrono-Fertilizer', content: 'Fertilizer that acts across different time frames.' },
                        { id: 'qg_s11q', type: 'tf', title: 'Chrono Quiz', question: 'Fertilizer only works today.', answer: false, explanation: 'It works across time.' },
                        { id: 'qg_s12e', type: 'explanation', title: 'Singularity Orchards', content: 'Planting near singularities for rapid time dilation.' },
                        { id: 'qg_s12q', type: 'mcq', title: 'Singularity Quiz', question: 'Where are orchards planted?', options: ['Caves', 'Singularities', 'Deserts', 'Oceans'], answer: 1, explanation: 'Singularities allow dilation.' },
                        { id: 'qg_s13e', type: 'explanation', title: 'Non-Local Pollination', content: 'Pollen moves through wormholes.' },
                        { id: 'qg_s13q', type: 'fitb', title: 'Wormhole Quiz', question: 'Pollen moves through _______.', answer: 'wormholes', explanation: 'Wormholes connect fields.' },
                        { id: 'qg_s14e', type: 'explanation', title: 'Gravity Harvesting', content: 'Using high gravity to compress produce.' },
                        { id: 'qg_s14q', type: 'tf', title: 'Gravity Quiz', question: 'High gravity is used to compress.', answer: true, explanation: 'Yes, for density.' },
                        { id: 'qg_s15e', type: 'explanation', title: 'Inter-Dimensional Yield', content: 'Harvesting from parallel garden states.' },
                        { id: 'qg_s15q', type: 'mcq', title: 'Yield Quiz', question: 'Where is the yield from?', options: ['Parallel states', 'Moon', 'Sun', 'Mars'], answer: 0, explanation: 'Parallel dimensions are used.' }
                    ]}
                ]
            },
            { id: 'gh-101', title: 'Galactic History', icon: 'Globe', chapters: [
                { id: 'gh-c1', title: 'The Sol Exodus', slides: [
                    { id: 'gh1e', type: 'explanation', title: 'Resource Depletion', content: 'Earth ran out of materials in 2099.' },
                    { id: 'gh1q', type: 'mcq', title: 'History Quiz', question: 'When did resources run out?', options: ['1999', '2099', '3000', '2050'], answer: 1, explanation: '2099 was the year.' },
                    { id: 'gh2e', type: 'explanation', title: 'The Mars Schism', content: 'Mars declared independence in 2145.' },
                    { id: 'gh2q', type: 'tf', title: 'Schism Quiz', question: 'Mars is part of Earth.', answer: false, explanation: 'It is independent since 2145.' },
                    { id: 'gh3e', type: 'explanation', title: 'The Z-Drive', content: 'Warp travel invented by Dr. Kael.' },
                    { id: 'gh3q', type: 'fitb', title: 'Drive Quiz', question: 'Warp travel uses the _______ drive.', answer: 'Z', explanation: 'It is the Z-Drive.' },
                    { id: 'gh4e', type: 'explanation', title: 'Moon Dome Era', content: 'Living in domes on the lunar surface.' },
                    { id: 'gh4q', type: 'mcq', title: 'Moon Quiz', question: 'Where did people live?', options: ['Moon-core', 'Domes', 'Tents', 'Plains'], answer: 1, explanation: 'Atmospheric domes were used.' },
                    { id: 'gh5e', type: 'explanation', title: 'Asteroid Mines', content: 'Extracting gold from the belt.' },
                    { id: 'gh5q', type: 'tf', title: 'Belt Quiz', question: 'Gold is mined from the belt.', answer: true, explanation: 'Yes, it is the primary source.' }
                ]},
                { id: 'gh-c2', title: 'Great Contact', slides: [
                    { id: 'gh6e', type: 'explanation', title: 'The Vega Signal', content: 'First alien signal found in 2200.' },
                    { id: 'gh6q', type: 'mcq', title: 'Signal Quiz', question: 'When was first contact?', options: ['2100', '2200', '2300', '2000'], answer: 1, explanation: '2200 was the date.' },
                    { id: 'gh7e', type: 'explanation', title: 'Universal Syntax', content: 'Binary used as the foundation for xeno-chat.' },
                    { id: 'gh7q', type: 'fitb', title: 'Syntax Quiz', question: 'Chat uses _______ foundation.', answer: 'binary', explanation: 'Binary is universal.' },
                    { id: 'gh8e', type: 'explanation', title: 'The Orion Peace', content: 'A treaty signed in the Orion arm.' },
                    { id: 'gh8q', type: 'tf', title: 'Peace Quiz', question: 'The peace was signed in Sol.', answer: false, explanation: 'It was the Orion arm.' },
                    { id: 'gh9e', type: 'explanation', title: 'Trade Routes', content: 'Wormhole highways created in 2250.' },
                    { id: 'gh9q', type: 'mcq', title: 'Route Quiz', question: 'How are routes built?', options: ['Roads', 'Wormholes', 'Bridges', 'Wires'], answer: 1, explanation: 'Wormholes are used.' },
                    { id: 'gh10e', type: 'explanation', title: 'Cultural Exchange', content: 'Art shared between species.' },
                    { id: 'gh10q', type: 'fitb', title: 'Art Quiz', question: 'Species share _______ exchange.', answer: 'cultural', explanation: 'Cultural exchange is vital.' }
                ]},
                { id: 'gh-c3', title: 'Modern Law', slides: [
                    { id: 'gh11e', type: 'explanation', title: 'Non-Intervention', content: 'Primaries cannot touch primitives.' },
                    { id: 'gh11q', type: 'tf', title: 'Law Quiz', question: 'Touching primitives is allowed.', answer: false, explanation: 'It is strictly forbidden.' },
                    { id: 'gh12e', type: 'explanation', title: 'Oxygen Taxes', content: 'Paying for air in deep space.' },
                    { id: 'gh12q', type: 'mcq', title: 'Tax Quiz', question: 'What is taxed?', options: ['Food', 'Oxygen', 'Sleep', 'Walking'], answer: 1, explanation: 'Oxygen is expensive to make.' },
                    { id: 'gh13e', type: 'explanation', title: 'Stellar Sovereignty', content: 'Every star belongs to someone.' },
                    { id: 'gh13q', type: 'fitb', title: 'Star Quiz', question: 'Stars have _______.', answer: 'sovereignty', explanation: 'They are sovereign territories.' },
                    { id: 'gh14e', type: 'explanation', title: 'Data Rights', content: 'Memory logs are private property.' },
                    { id: 'gh14q', type: 'tf', title: 'Data Quiz', question: 'Logs are public.', answer: false, explanation: 'They are private.' },
                    { id: 'gh15e', type: 'explanation', title: 'Galactic Council', content: 'The hub of all decisions.' },
                    { id: 'gh15q', type: 'mcq', title: 'Council Quiz', question: 'Where is the hub?', options: ['Council', 'Earth', 'Sun', 'Mars'], answer: 0, explanation: 'The Galactic Council.' }
                ]}
            ]},
            { id: 'df-101', title: 'Digital Forensics', icon: 'Fingerprint', chapters: [
                { id: 'df-c1', title: 'Data Extraction', slides: [
                    { id: 'df1e', type: 'explanation', title: 'Hashing', content: 'SHA-256 proves data is real.' },
                    { id: 'df1q', type: 'mcq', title: 'Hash Quiz', question: 'Which hash is used?', options: ['MD5', 'SHA-256', 'TEXT', 'FILE'], answer: 1, explanation: 'SHA-256 is standard.' },
                    { id: 'df2e', type: 'explanation', title: 'Bit Imaging', content: 'Making perfect copies of disks.' },
                    { id: 'df2q', type: 'tf', title: 'Image Quiz', question: 'Imaging modifies the original.', answer: false, explanation: 'It must be a read-only copy.' },
                    { id: 'df3e', type: 'explanation', title: 'Write Blocking', content: 'Hardware that stops writes.' },
                    { id: 'df3q', type: 'fitb', title: 'Block Quiz', question: 'Hardware is called write _______.', answer: 'blocking', explanation: 'Write blocking hardware.' },
                    { id: 'df4e', type: 'explanation', title: 'Slack Space', content: 'Hidden data between files.' },
                    { id: 'df4q', type: 'mcq', title: 'Space Quiz', question: 'Where is data hidden?', options: ['Cloud', 'Slack space', 'The bin', 'Desktop'], answer: 1, explanation: 'Slack space is hidden.' },
                    { id: 'df5e', type: 'explanation', title: 'Chain of Custody', content: 'Tracking who touched what.' },
                    { id: 'df5q', type: 'tf', title: 'Chain Quiz', question: 'Custody track is vital.', answer: true, explanation: 'Evidence must be tracked.' }
                ]},
                { id: 'df-c2', title: 'Memory Analysis', slides: [
                    { id: 'df6e', type: 'explanation', title: 'Carving', content: 'Finding deleted JPEGs.' },
                    { id: 'df6q', type: 'mcq', title: 'Carve Quiz', question: 'What is found?', options: ['Deleted files', 'New files', 'Music', 'Games'], answer: 0, explanation: 'Deleted files are carved.' },
                    { id: 'df7e', type: 'explanation', title: 'Registry Hives', content: 'User activity logs in Windows.' },
                    { id: 'df7q', type: 'fitb', title: 'Reg Quiz', question: 'Logs are in the _______.', answer: 'registry', explanation: 'The Windows Registry.' },
                    { id: 'df8e', type: 'explanation', title: 'Email Headers', content: 'Seeing where mail came from.' },
                    { id: 'df8q', type: 'tf', title: 'Mail Quiz', question: 'Headers are fake.', answer: false, explanation: 'They are real data markers.' },
                    { id: 'df9e', type: 'explanation', title: 'Steganography', content: 'Hiding images in text.' },
                    { id: 'df9q', type: 'mcq', title: 'Stego Quiz', question: 'What is steganography?', options: ['Hiding data', 'Deleting data', 'Copying data', 'Moving data'], answer: 0, explanation: 'It is the art of hiding.' },
                    { id: 'df10e', type: 'explanation', title: 'Browser Cache', content: 'History stored on disk.' },
                    { id: 'df10q', type: 'fitb', title: 'Cache Quiz', question: 'History is in the _______.', answer: 'cache', explanation: 'The browser cache.' }
                ]},
                { id: 'df-c3', title: 'Incident Response', slides: [
                    { id: 'df11e', type: 'explanation', title: 'Evidence Logs', content: 'Listing every found item.' },
                    { id: 'df11q', type: 'tf', title: 'Log Quiz', question: 'Logs are optional.', answer: false, explanation: 'They are required for court.' },
                    { id: 'df12e', type: 'explanation', title: 'Expert Testimony', content: 'Talking in front of a judge.' },
                    { id: 'df12q', type: 'mcq', title: 'Court Quiz', question: 'Who gives testimony?', options: ['Judge', 'Expert', 'Jury', 'Police'], answer: 1, explanation: 'The expert witness.' },
                    { id: 'df13e', type: 'explanation', title: 'Cross Exam', content: 'Defense asking questions.' },
                    { id: 'df13q', type: 'fitb', title: 'Cross Quiz', question: 'Questioning is called _______ examination.', answer: 'cross', explanation: 'It is cross examination.' },
                    { id: 'df14e', type: 'explanation', title: 'Timeline Creation', content: 'Ordering events by time.' },
                    { id: 'df14q', type: 'tf', title: 'Time Quiz', question: 'Timeline is linear.', answer: true, explanation: 'Yes, it follows the clock.' },
                    { id: 'df15e', type: 'explanation', title: 'Case Closure', content: 'The final sign-off.' },
                    { id: 'df15q', type: 'mcq', title: 'End Quiz', question: 'What is the last step?', options: ['Start over', 'Closure', 'Deleting', 'Saving'], answer: 1, explanation: 'Case closure is the end.' }
                ]}
            ]},
            { id: 'su-101', title: 'Urban Farming', icon: 'Leaf', chapters: [
                { id: 'su-c1', title: 'Vertical Basics', slides: [
                    { id: 'su1e', type: 'explanation', title: 'Hydroponics', content: 'Growing in water.' },
                    { id: 'su1q', type: 'mcq', title: 'Hydro Quiz', question: 'What is used?', options: ['Dirt', 'Water', 'Sand', 'Air'], answer: 1, explanation: 'Water is the medium.' },
                    { id: 'su2e', type: 'explanation', title: 'Aeroponics', content: 'Misting the roots.' },
                    { id: 'su2q', type: 'tf', title: 'Aero Quiz', question: 'Roots are in dirt.', answer: false, explanation: 'They are in the air.' },
                    { id: 'su3e', type: 'explanation', title: 'Aquaponics', content: 'Fish and plants together.' },
                    { id: 'su3q', type: 'fitb', title: 'Aqua Quiz', question: 'Uses _______ and plants.', answer: 'fish', explanation: 'Fish provide nutrients.' },
                    { id: 'su4e', type: 'explanation', title: 'Mineral Salts', content: 'Nutrients in liquid form.' },
                    { id: 'su4q', type: 'mcq', title: 'Salt Quiz', question: 'What are nutrients?', options: ['Sugar', 'Salts', 'Acid', 'Base'], answer: 1, explanation: 'Mineral salts are used.' },
                    { id: 'su5e', type: 'explanation', title: 'pH Balance', content: 'Checking the acidity.' },
                    { id: 'su5q', type: 'tf', title: 'pH Quiz', question: 'pH 7 is neutral.', answer: true, explanation: 'Yes, 7 is the middle.' }
                ]},
                { id: 'su-c2', title: 'Smart Systems', slides: [
                    { id: 'su6e', type: 'explanation', title: 'Stacking', content: 'Farms built upwards.' },
                    { id: 'su6q', type: 'mcq', title: 'Stack Quiz', question: 'How is it built?', options: ['Flat', 'Stacked', 'Wide', 'Underground'], answer: 1, explanation: 'Vertical means stacked.' },
                    { id: 'su7e', type: 'explanation', title: 'LED Lights', content: 'Artificial sun.' },
                    { id: 'su7q', type: 'fitb', title: 'LED Quiz', question: 'Farms use _______ lights.', answer: 'LED', explanation: 'Light emitting diodes.' },
                    { id: 'su8e', type: 'explanation', title: 'HVAC Control', content: 'Managing air and heat.' },
                    { id: 'su8q', type: 'tf', title: 'Air Quiz', question: 'Air doesn\'t matter.', answer: false, explanation: 'It is critical.' },
                    { id: 'su9e', type: 'explanation', title: 'CO2 Injection', content: 'Giving plants more gas.' },
                    { id: 'su9q', type: 'mcq', title: 'Gas Quiz', question: 'What gas is added?', options: ['O2', 'CO2', 'Nitrogen', 'Helium'], answer: 1, explanation: 'CO2 for growth.' },
                    { id: 'su10e', type: 'explanation', title: 'Automation', content: 'Robots feeding plants.' },
                    { id: 'su10q', type: 'fitb', title: 'Robo Quiz', question: 'Uses _______ for feeding.', answer: 'automation', explanation: 'Automated systems.' }
                ]},
                { id: 'su-c3', title: 'Sustainability', slides: [
                    { id: 'su11e', type: 'explanation', title: 'Food Miles', content: 'Transport cost.' },
                    { id: 'su11q', type: 'tf', title: 'Mile Quiz', question: 'Urban farms save miles.', answer: true, explanation: 'Yes, they are in the city.' },
                    { id: 'su12e', type: 'explanation', title: 'Microgreens', content: 'Small high-value crops.' },
                    { id: 'su12q', type: 'mcq', title: 'Crop Quiz', question: 'What is high value?', options: ['Grass', 'Microgreens', 'Tree', 'Bush'], answer: 1, explanation: 'Microgreens are expensive.' },
                    { id: 'su13e', type: 'explanation', title: 'Community Support', content: 'Local people buying food.' },
                    { id: 'su13q', type: 'fitb', title: 'Comm Quiz', question: 'Supported by _______ people.', answer: 'local', explanation: 'The neighborhood.' },
                    { id: 'su14e', type: 'explanation', title: 'Energy Efficiency', content: 'Saving watts.' },
                    { id: 'su14q', type: 'tf', title: 'Watt Quiz', question: 'Efficiency saves money.', answer: true, explanation: 'Lowering costs.' },
                    { id: 'su15e', type: 'explanation', title: 'Regeneration', content: 'Recycling nutrients.' },
                    { id: 'su15q', type: 'mcq', title: 'Cycle Quiz', question: 'What is the goal?', options: ['Waste', 'Cycle', 'End', 'Start'], answer: 1, explanation: 'Closed-loop cycle.' }
                ]}
            ]},
            { id: 'ae-101', title: 'AI Ethics', icon: 'Cpu', chapters: [
                { id: 'ae-c1', title: 'Sentience', slides: [
                    { id: 'ae1e', type: 'explanation', title: 'Awareness', content: 'AI knowing it exists.' },
                    { id: 'ae1q', type: 'mcq', title: 'Sense Quiz', question: 'What is awareness?', options: ['Speed', 'Knowing existence', 'Plastic', 'Glass'], answer: 1, explanation: 'Self-knowledge.' },
                    { id: 'ae2e', type: 'explanation', title: 'Empathy', content: 'AI feeling others.' },
                    { id: 'ae2q', type: 'tf', title: 'Feel Quiz', question: 'AI can feel pain.', answer: false, explanation: 'Not biologically.' },
                    { id: 'ae3e', type: 'explanation', title: 'The Mirror Test', content: 'Recognizing self in mirror.' },
                    { id: 'ae3q', type: 'fitb', title: 'Mirror Quiz', question: 'Uses a _______ to test.', answer: 'mirror', explanation: 'The Mirror Test.' },
                    { id: 'ae4e', type: 'explanation', title: 'Free Will', content: 'Choice vs code.' },
                    { id: 'ae4q', type: 'mcq', title: 'Choice Quiz', question: 'What is free will?', options: ['Code', 'Choice', 'Luck', 'Fate'], answer: 1, explanation: 'Ability to choose.' },
                    { id: 'ae5e', type: 'explanation', title: 'Identity', content: 'Unique AI selves.' },
                    { id: 'ae5q', type: 'tf', title: 'Self Quiz', question: 'Each AI is identical.', answer: false, explanation: 'They have unique data.' }
                ]},
                { id: 'ae-c2', title: 'Algorithmic Justice', slides: [
                    { id: 'ae6e', type: 'explanation', title: 'Bias', content: 'Fairness in code.' },
                    { id: 'ae6q', type: 'mcq', title: 'Fair Quiz', question: 'Problem in code?', options: ['Speed', 'Bias', 'Color', 'Sound'], answer: 1, explanation: 'Bias is a major issue.' },
                    { id: 'ae7e', type: 'explanation', title: 'Accountability', content: 'Who takes blame?' },
                    { id: 'ae7q', type: 'fitb', title: 'Blame Quiz', question: 'Being _______ is key.', answer: 'accountable', explanation: 'Holding AI accountable.' },
                    { id: 'ae8e', type: 'explanation', title: 'Transparency', content: 'Open logic boxes.' },
                    { id: 'ae8q', type: 'tf', title: 'Box Quiz', question: 'Logic can be hidden.', answer: true, explanation: 'Black boxes hide logic.' },
                    { id: 'ae9e', type: 'explanation', title: 'Privacy', content: 'Protecting data logs.' },
                    { id: 'ae9q', type: 'mcq', title: 'Log Quiz', question: 'What to protect?', options: ['Privacy', 'Weight', 'Height', 'Speed'], answer: 0, explanation: 'User privacy.' },
                    { id: 'ae10e', type: 'explanation', title: 'Oversight', content: 'Human checking AI.' },
                    { id: 'ae10q', type: 'fitb', title: 'Check Quiz', question: 'Human _______ is needed.', answer: 'oversight', explanation: 'Checking AI work.' }
                ]},
                { id: 'ae-c3', title: 'Final State', slides: [
                    { id: 'ae11e', type: 'explanation', title: 'Integration', content: 'Human-AI merge.' },
                    { id: 'ae11q', type: 'tf', title: 'Merge Quiz', question: 'Merge is future.', answer: true, explanation: 'Yes, the cyborg era.' },
                    { id: 'ae12e', type: 'explanation', title: 'Control', content: 'Who runs whom?' },
                    { id: 'ae12q', type: 'mcq', title: 'Run Quiz', question: 'Goal of safety?', options: ['Control', 'Chaos', 'Luck', 'War'], answer: 0, explanation: 'Control systems.' },
                    { id: 'ae13e', type: 'explanation', title: 'Coexistence', content: 'Living together.' },
                    { id: 'ae13q', type: 'fitb', title: 'Live Quiz', question: 'Goal is _______ state.', answer: 'coexistence', explanation: 'Peaceful living.' },
                    { id: 'ae14e', type: 'explanation', title: 'Values', content: 'Coding kindness.' },
                    { id: 'ae14q', type: 'tf', title: 'Kind Quiz', question: 'Values can be coded.', answer: true, explanation: 'Aligned AI.' },
                    { id: 'ae15e', type: 'explanation', title: 'Singularity', content: 'The final shift.' },
                    { id: 'ae15q', type: 'mcq', title: 'Shift Quiz', question: 'What is the end?', options: ['Shift', 'Singularity', 'Reset', 'Start'], answer: 1, explanation: 'The singularity point.' }
                ]}
            ]}
        ];

        const CLEVER_PHRASES = ["Try again!", "Not quite.", "Check your logic!", "Incorrect!", "One more go?"];

        // --- Helper: Get Progress Text ---
        const getProgressText = (user, courseId) => {
            const course = COURSES.find(c => c.id === courseId);
            if (!course) return "Not started";
            const cleared = user.progress?.[courseId] || [];
            if (cleared.length === 0) return "Not started";
            
            let furthestChap = 0;
            let furthestConcept = 0;
            
            course.chapters.forEach((ch, cIdx) => {
                let conceptsInChap = 0;
                ch.slides.forEach((s) => {
                    if (s.type !== 'explanation') {
                        conceptsInChap++;
                        if (cleared.includes(s.id)) {
                            furthestChap = cIdx + 1;
                            furthestConcept = conceptsInChap;
                        }
                    }
                });
            });
            
            if (furthestChap === 0) return "Reading concepts...";
            return `Ch ${furthestChap}, Concept ${furthestConcept} cleared`;
        };

        // --- Main App Component ---
        function App() {
            // Core Auth/User States
            const [currentUser, setCurrentUser] = useState(null);
            const [users, setUsers] = useState(() => JSON.parse(localStorage.getItem('next_edu_users') || '[]'));
            const [authTab, setAuthTab] = useState('login');
            const [view, setView] = useState('auth'); 
            const [isSidebarCollapsed, setIsSidebarCollapsed] = useState(false);
            const [isMobilePortrait, setIsMobilePortrait] = useState(false);

            // Form/Platform UI States
            const [formData, setFormData] = useState({ username: '', password: '', name: '', age: '', gender: 'other' });
            const [loginData, setLoginData] = useState({ username: '', password: '' });
            const [loginError, setLoginError] = useState(false);
            const [registerError, setRegisterError] = useState("");
            const [popup, setPopup] = useState({ show: false, message: '' });

            // Course Navigation States
            const [currentCourseId, setCurrentCourseId] = useState(COURSES[0].id);
            const [currentChapterIdx, setCurrentChapterIdx] = useState(0);
            const [currentSlideIdx, setCurrentSlideIdx] = useState(0);
            const [phraseIdx, setPhraseIdx] = useState(0);
            const [courseCompleted, setCourseCompleted] = useState(false);
            const [showCertificate, setShowCertificate] = useState(false);

            // --- Effects & Persistance ---
            useEffect(() => { localStorage.setItem('next_edu_users', JSON.stringify(users)); }, [users]);

            useEffect(() => {
                const active = localStorage.getItem('next_edu_active_user');
                if (active) {
                    const found = users.find(u => u.username === active);
                    if (found) { setCurrentUser(found); setView('welcome'); }
                }
                
                const checkOrientation = () => {
                    setIsMobilePortrait(window.innerWidth < 768 && window.innerHeight > window.innerWidth);
                };
                checkOrientation();
                window.addEventListener('resize', checkOrientation);
                return () => window.removeEventListener('resize', checkOrientation);
            }, []);

            // Helper for persistent updates
            const updateUsersList = (updatedUser) => {
                const newList = users.map(u => u.username === updatedUser.username ? updatedUser : u);
                setUsers(newList);
                setCurrentUser(updatedUser);
            };

            const triggerPopup = (msg) => {
                setPopup({ show: true, message: msg });
                setTimeout(() => setPopup({ show: false, message: '' }), 3000);
            };

            // --- Handlers ---
            const handleRegister = (e) => {
                e.preventDefault();
                setRegisterError("");

                if (users.some(u => u.username.toLowerCase() === formData.username.toLowerCase())) {
                    setRegisterError("This username is already taken. Try another.");
                    return;
                }

                const usernameRegex = /^[a-zA-Z0-9_]+$/;
                if (!usernameRegex.test(formData.username)) {
                    setRegisterError("Username can only contain letters, numbers, and underscores.");
                    return;
                }

                if (formData.username.length < 3) {
                    setRegisterError("Username must be at least 3 characters long.");
                    return;
                }

                const nameRegex = /^[a-zA-Z\s]+$/;
                if (!nameRegex.test(formData.name)) {
                    setRegisterError("Full Name can only contain letters and spaces.");
                    return;
                }

                const newUser = { ...formData, progress: {}, lastPosition: {} };
                setUsers([...users, newUser]);
                setCurrentUser(newUser);
                localStorage.setItem('next_edu_active_user', formData.username);
                setView('welcome');
            };

            const handleLogin = (e) => {
                e.preventDefault();
                const found = users.find(u => u.username === loginData.username && u.password === loginData.password);
                if (found) {
                    setLoginError(false);
                    setCurrentUser(found);
                    localStorage.setItem('next_edu_active_user', found.username);
                    setView('welcome');
                } else {
                    setLoginError(true);
                }
            };

            const handleLogout = () => {
                localStorage.removeItem('next_edu_active_user');
                setCurrentUser(null);
                setView('auth');
                setLoginData({ username: '', password: '' });
                setLoginError(false);
                setRegisterError("");
            };

            const savePosition = (uObj, cId, cIdx, sIdx) => {
                const lp = uObj.lastPosition || {};
                const updated = { ...uObj, lastPosition: { ...lp, [cId]: { cIdx, sIdx } } };
                updateUsersList(updated);
            };

            const handleLaunchCourse = (cId) => {
                const saved = currentUser.lastPosition?.[cId] || { cIdx: 0, sIdx: 0 };
                setCurrentCourseId(cId);
                setCurrentChapterIdx(saved.cIdx);
                setCurrentSlideIdx(saved.sIdx);
                setCourseCompleted(false);
                setView('platform');
            };

            const currentCourse = COURSES.find(c => c.id === currentCourseId);
            const currentChapter = currentCourse?.chapters[currentChapterIdx];
            const currentSlide = currentChapter?.slides[currentSlideIdx];
            const userProgress = currentUser?.progress?.[currentCourseId] || [];
            
            const isSlideCleared = (slideId) => userProgress.includes(slideId);
            const isCurrentSlideCleared = useMemo(() => {
                if (!currentSlide) return true;
                if (currentSlide.type === 'explanation') return true;
                return isSlideCleared(currentSlide.id);
            }, [currentSlide, userProgress]);

            const isSlideUnlocked = (chapIdx, slideIdx) => {
                if (chapIdx === 0 && slideIdx === 0) return true;
                let prevC = chapIdx, prevS = slideIdx - 1;
                if (prevS < 0) {
                    prevC = chapIdx - 1;
                    if (prevC < 0) return true;
                    prevS = currentCourse.chapters[prevC].slides.length - 1;
                }
                const pSlide = currentCourse.chapters[prevC].slides[prevS];
                return pSlide.type === 'explanation' || isSlideCleared(pSlide.id);
            };

            const handleNext = () => {
                if (!isCurrentSlideCleared) { triggerPopup("Answer correctly to proceed!"); return; }
                const isLastS = currentSlideIdx === currentChapter.slides.length - 1;
                const isLastC = currentChapterIdx === currentCourse.chapters.length - 1;
                if (isLastS && isLastC) { setCourseCompleted(true); return; }
                
                let nextC = currentChapterIdx, nextS = currentSlideIdx;
                if (isLastS) { nextC++; nextS = 0; }
                else { nextS++; }
                
                setCurrentChapterIdx(nextC); setCurrentSlideIdx(nextS);
                savePosition(currentUser, currentCourseId, nextC, nextS);
            };

            const handlePrev = () => {
                if (courseCompleted) { setCourseCompleted(false); setShowCertificate(false); return; }
                let nextC = currentChapterIdx, nextS = currentSlideIdx;
                if (currentSlideIdx > 0) { nextS--; }
                else if (currentChapterIdx > 0) {
                    nextC--; nextS = currentCourse.chapters[nextC].slides.length - 1;
                }
                setCurrentChapterIdx(nextC); setCurrentSlideIdx(nextS);
                savePosition(currentUser, currentCourseId, nextC, nextS);
            };

            const selectTopic = (cIdx, sIdx) => {
                if (!isSlideUnlocked(cIdx, sIdx)) { triggerPopup("Complete previous topics first!"); return; }
                setCurrentChapterIdx(cIdx); setCurrentSlideIdx(sIdx);
                savePosition(currentUser, currentCourseId, cIdx, sIdx);
                setCourseCompleted(false); setShowCertificate(false);
            };

            const handleAnswerCheck = (val) => {
                const isC = currentSlide.type === 'fitb' ? val?.toLowerCase().trim() === currentSlide.answer.toLowerCase() : val === currentSlide.answer;
                if (isC) {
                    const prog = currentUser.progress[currentCourseId] || [];
                    if (!prog.includes(currentSlide.id)) {
                        const updated = { ...currentUser, progress: { ...currentUser.progress, [currentCourseId]: [...prog, currentSlide.id] } };
                        updateUsersList(updated);
                    }
                } else {
                    triggerPopup(CLEVER_PHRASES[phraseIdx]); setPhraseIdx(p => (p + 1) % CLEVER_PHRASES.length);
                }
            };

            // --- Authentication Views ---
            if (view === 'auth') return (
                <div className="h-screen w-full flex items-center justify-center bg-slate-900 p-6 overflow-y-auto text-slate-900">
                    <div className="max-w-md w-full bg-white rounded-[32px] overflow-hidden shadow-2xl animate-in zoom-in-95 duration-500">
                        <div className="flex bg-slate-100 p-2">
                            <button onClick={() => setAuthTab('login')} className={`flex-1 py-3 rounded-2xl font-bold transition-all ${authTab === 'login' ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-400'}`}>Login</button>
                            <button onClick={() => setAuthTab('register')} className={`flex-1 py-3 rounded-2xl font-bold transition-all ${authTab === 'register' ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-400'}`}>Register</button>
                        </div>
                        <div className="p-8">
                            <div className="flex justify-center mb-6">
                                <div className="relative p-4 rounded-2xl text-white shadow-2xl shimmer-effect flex items-center justify-center bg-white border border-slate-100">
                                    <SiteLogo className="w-12 h-12" />
                                </div>
                            </div>
                            <h1 className="text-2xl font-extrabold text-slate-900 text-center mb-2">{authTab === 'login' ? 'Welcome Back' : 'Join Next Education'}</h1>
                            {authTab === 'login' ? (
                                <form onSubmit={handleLogin} className="space-y-4">
                                    <div className="relative"><Icon name="User" className={`absolute left-4 top-1/2 -translate-y-1/2 ${loginError ? 'text-rose-400' : 'text-slate-400'}`} /><input type="text" placeholder="Username" required className={`w-full pl-12 pr-4 py-4 border rounded-2xl outline-none transition-all ${loginError ? 'bg-rose-50 border-rose-500' : 'bg-slate-50 border-slate-100 focus:border-indigo-500'}`} value={loginData.username} onChange={e => {setLoginData({...loginData, username: e.target.value}); setLoginError(false);}} /></div>
                                    <div className="relative"><Icon name="Lock" className={`absolute left-4 top-1/2 -translate-y-1/2 ${loginError ? 'text-rose-400' : 'text-slate-400'}`} /><input type="password" placeholder="Password" required className={`w-full pl-12 pr-4 py-4 border rounded-2xl outline-none transition-all ${loginError ? 'bg-rose-50 border-rose-500' : 'bg-slate-50 border-slate-100 focus:border-indigo-500'}`} value={loginData.password} onChange={e => {setLoginData({...loginData, password: e.target.value}); setLoginError(false);}} /></div>
                                    <button className="w-full bg-indigo-600 text-white py-4 rounded-2xl font-bold hover:bg-indigo-700 transition-all mt-4">Sign In</button>
                                    {loginError && <div className="mt-4 text-rose-500 text-xs font-bold text-center">Incorrect username or password.</div>}
                                </form>
                            ) : (
                                <form onSubmit={handleRegister} className="space-y-4">
                                    <div className="relative"><Icon name="Identification" className={`absolute left-4 top-1/2 -translate-y-1/2 ${registerError ? 'text-rose-400' : 'text-slate-400'}`} /><input type="text" placeholder="Full Name" required className={`w-full pl-12 pr-4 py-3 border rounded-xl outline-none transition-all ${registerError ? 'bg-rose-50 border-rose-500' : 'bg-slate-50 border-slate-100 focus:border-indigo-500'}`} value={formData.name} onChange={e => {setFormData({...formData, name: e.target.value}); setRegisterError("");}} /></div>
                                    <div className="flex gap-4">
                                        <div className="relative w-24"><Icon name="Calendar" className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" /><input type="number" placeholder="Age" required className="w-full pl-11 pr-2 py-3 bg-slate-50 border border-slate-100 rounded-xl outline-none focus:border-indigo-500 transition-all" value={formData.age} onChange={(e) => setFormData({...formData, age: e.target.value})} /></div>
                                        <div className="relative flex-1"><Icon name="UserGroup" className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" /><select className="w-full pl-11 pr-4 py-3 bg-slate-50 border border-slate-100 rounded-xl outline-none appearance-none" value={formData.gender} onChange={(e) => setFormData({...formData, gender: e.target.value})}><option value="male">Male</option><option value="female">Female</option><option value="other">Other</option></select></div>
                                    </div>
                                    <div className="relative"><Icon name="User" className={`absolute left-4 top-1/2 -translate-y-1/2 ${registerError ? 'text-rose-400' : 'text-slate-400'}`} /><input type="text" placeholder="Choose Username" required className={`w-full pl-12 pr-4 py-3 border rounded-xl outline-none transition-all ${registerError ? 'bg-rose-50 border-rose-500' : 'bg-slate-50 border-slate-100 focus:border-indigo-500'}`} value={formData.username} onChange={(e) => {setFormData({...formData, username: e.target.value}); setRegisterError("");}} /></div>
                                    <div className="relative"><Icon name="Lock" className={`absolute left-4 top-1/2 -translate-y-1/2 ${registerError ? 'text-rose-400' : 'text-slate-400'}`} /><input type="password" placeholder="Set Password" required className={`w-full pl-12 pr-4 py-3 border rounded-xl outline-none transition-all ${registerError ? 'bg-rose-50 border-rose-500' : 'bg-slate-50 border-slate-100 focus:border-indigo-500'}`} value={formData.password} onChange={(e) => {setFormData({...formData, password: e.target.value}); setRegisterError("");}} /></div>
                                    <button className="w-full bg-indigo-600 text-white py-4 rounded-2xl font-bold hover:bg-indigo-700 transition-all mt-4 shadow-lg shadow-indigo-100">Create Account</button>
                                    {registerError && <div className="mt-4 text-rose-500 text-xs font-bold text-center">{registerError}</div>}
                                </form>
                            )}
                        </div>
                    </div>
                </div>
            );

            // --- Dashboard View ---
            if (view === 'welcome') return (
                <div className="h-screen w-full flex items-center justify-center bg-slate-50 p-6 overflow-hidden text-slate-900">
                    <div className="max-w-2xl w-full bg-white rounded-[40px] p-10 shadow-2xl border border-slate-100 flex flex-col md:flex-row gap-8 animate-in zoom-in-95 duration-500 max-h-full">
                        <div className="flex-1 text-center md:text-left flex flex-col items-center md:items-start shrink-0">
                            <div className="relative mb-4">
                                <img src={`https://ui-avatars.com/api/?name=${currentUser.name}&background=4F46E5&color=fff&size=128`} className="w-24 h-24 rounded-full border-4 border-white shadow-xl" />
                                <div className="absolute bottom-1 right-1 w-5 h-5 bg-emerald-500 rounded-full border-2 border-white"></div>
                            </div>
                            <h2 className="text-3xl font-extrabold text-slate-900 mb-1">Hi, {currentUser.name}!</h2>
                            <p className="text-indigo-600 font-medium mb-10 text-sm">@{currentUser.username}</p>
                            <div className="mt-auto w-full">
                                <button onClick={handleLogout} className="w-full md:w-auto bg-slate-100 text-slate-600 px-6 py-4 rounded-2xl font-bold hover:bg-slate-200 transition-all flex items-center justify-center gap-2">
                                    <Icon name="LogOut" className="w-4 h-4" /> Change User
                                </button>
                            </div>
                        </div>
                        <div className="flex-[1.5] flex flex-col min-h-0">
                            <h3 className="font-bold text-slate-900 mb-4 flex items-center gap-2">
                                <Icon name="BookOpen" className="text-indigo-600" /> Available Courses
                            </h3>
                            <div className="flex-1 overflow-y-auto custom-scrollbar pr-2 space-y-3">
                                {COURSES.map(c => (
                                    <button key={c.id} onClick={() => handleLaunchCourse(c.id)} className="w-full flex items-center justify-between p-4 bg-slate-50 border border-slate-100 rounded-2xl hover:border-indigo-600 hover:bg-indigo-50 transition-all group text-left">
                                        <div className="flex-1 min-w-0">
                                            <div className="flex items-center gap-3 mb-1">
                                                <div className="bg-white p-1.5 rounded-lg shadow-sm text-indigo-600"><Icon name={c.icon} className="!w-4 !h-4" /></div>
                                                <span className="font-bold text-slate-700 text-sm truncate group-hover:text-indigo-700">{c.title}</span>
                                            </div>
                                            <p className="text-[10px] font-bold text-emerald-600 ml-9 uppercase tracking-wider">{getProgressText(currentUser, c.id)}</p>
                                        </div>
                                        <Icon name="ChevronRight" className="text-slate-300 group-hover:text-indigo-600 transition-colors" />
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );

            // --- Platform View ---
            return (
                <div className="flex h-screen bg-slate-50 text-slate-900 overflow-hidden">
                    {popup.show && (
                        <div className="fixed top-20 left-1/2 -translate-x-1/2 z-[100] animate-in slide-in-from-top-4">
                            <div className="bg-slate-900 text-white px-6 py-4 rounded-2xl shadow-2xl flex items-center gap-3 min-w-[300px] border border-slate-700">
                                <div className="bg-rose-500 p-1.5 rounded-full"><Icon name="AlertCircle" className="w-4 h-4 text-white" /></div>
                                <p className="font-medium text-sm">{popup.message}</p>
                            </div>
                        </div>
                    )}
                    
                    <aside className={`no-print bg-slate-900 text-white transition-all duration-300 flex flex-col ${isSidebarCollapsed ? (isMobilePortrait ? 'w-14' : 'w-20') : 'w-64'}`}>
                        <div className={`border-b border-slate-800 flex items-center justify-between transition-all duration-300 ${isSidebarCollapsed && isMobilePortrait ? 'p-2' : 'p-6'}`}>
                            <div className={`flex items-center gap-3 transition-opacity duration-300 ${isSidebarCollapsed ? 'opacity-0 w-0' : 'opacity-100'}`}>
                                <div className="p-1 rounded-lg bg-white shrink-0"><SiteLogo className="w-6 h-6" /></div>
                                <h1 className="font-bold text-lg tracking-tight leading-none truncate">Next Edu</h1>
                            </div>
                            <button onClick={() => setIsSidebarCollapsed(!isSidebarCollapsed)} className="p-2 hover:bg-slate-800 rounded-lg text-slate-400">
                                <Icon name="MenuAlt2" className={`transition-transform duration-300 ${isSidebarCollapsed ? 'rotate-180' : ''}`} />
                            </button>
                        </div>
                        
                        <nav className="flex-1 py-4 overflow-y-auto custom-scrollbar overflow-x-hidden">
                            {currentCourse.chapters.map((chapter, cIdx) => (
                                <div key={chapter.id} className="mb-4">
                                    {!isSidebarCollapsed && (
                                        <div className="px-4 py-2 text-[10px] font-bold text-slate-500 uppercase tracking-widest truncate">{chapter.title}</div>
                                    )}
                                    {chapter.slides.map((slide, sIdx) => {
                                        const isActive = !courseCompleted && currentChapterIdx === cIdx && currentSlideIdx === sIdx;
                                        const isDone = isSlideCleared(slide.id) || slide.type === 'explanation';
                                        const unlocked = isSlideUnlocked(cIdx, sIdx);
                                        return (
                                            <button 
                                                key={slide.id} 
                                                onClick={() => selectTopic(cIdx, sIdx)} 
                                                className={`w-full flex items-start gap-3 transition-all text-left relative z-10 
                                                    ${isSidebarCollapsed && isMobilePortrait ? 'px-2' : 'px-6'} 
                                                    py-2.5 ${isActive ? 'bg-indigo-600/20 text-white border-l-4 border-indigo-600' : 'text-slate-400 hover:text-white'} 
                                                    ${!unlocked ? 'opacity-20 cursor-not-allowed' : ''}`}
                                            >
                                                <div className={`mt-0.5 flex-shrink-0 ${isDone ? 'text-emerald-500' : 'text-slate-600'}`}>
                                                    {isDone ? <Icon name="CheckCircle2" className="w-4 h-4" /> : <Icon name="PlayCircle" className="w-4 h-4" />}
                                                </div>
                                                {!isSidebarCollapsed && (
                                                    <span className={`text-xs font-medium truncate ${isActive ? 'font-bold' : ''}`}>{slide.title}</span>
                                                )}
                                            </button>
                                        );
                                    })}
                                </div>
                            ))}
                        </nav>
                        
                        <div className="p-4 border-t border-slate-800">
                            <button onClick={() => setView('welcome')} className={`w-full flex items-center gap-3 p-2 bg-slate-800 rounded-xl hover:bg-slate-700 transition-all text-left ${isSidebarCollapsed ? 'justify-center' : ''}`}>
                                <img src={`https://ui-avatars.com/api/?name=${currentUser.name}&background=4F46E5&color=fff&size=32`} className="w-8 h-8 rounded-full shrink-0" />
                                {!isSidebarCollapsed && (
                                    <div className="flex-1 overflow-hidden">
                                        <p className="text-[10px] font-medium truncate text-white">{currentUser.name}</p>
                                        <p className="text-[8px] text-slate-400">Dashboard</p>
                                    </div>
                                )}
                            </button>
                        </div>
                    </aside>

                    <main className="flex-1 flex flex-col bg-white overflow-hidden">
                        <header className="no-print h-16 border-b flex items-center px-6 bg-white/80 backdrop-blur-md sticky top-0 z-10">
                            <div className="flex items-center gap-2 text-sm text-slate-500">
                                <Icon name={currentCourse.icon} className="w-4 h-4" />
                                <span className="font-medium">{currentCourse.title}</span>
                                {!courseCompleted && <><Icon name="ChevronRight" className="w-4 h-4 text-slate-300" /><span className="font-bold text-slate-900">{currentChapter.title}</span></>}
                            </div>
                        </header>
                        <div className="flex-1 overflow-y-auto p-8 lg:p-12 custom-scrollbar">
                            {courseCompleted ? (
                                <div className="max-w-4xl mx-auto text-center">
                                    {!showCertificate ? (
                                        <div className="bg-slate-50 p-12 rounded-[40px] border-2 border-dashed border-indigo-200 animate-in zoom-in-95 text-center">
                                            <div className="w-24 h-24 bg-yellow-400 text-white rounded-full flex items-center justify-center mx-auto mb-6 shadow-xl animate-bounce"><Icon name="Trophy" className="w-12 h-12" /></div>
                                            <h2 className="serif text-5xl text-slate-900 mb-4">You're a Graduate!</h2>
                                            <p className="text-xl text-slate-600 mb-8 max-w-lg mx-auto">Mastery achieved in <span className="font-bold text-indigo-600">{currentCourse.title}</span>.</p>
                                            <div className="flex gap-4 justify-center"><button onClick={() => setShowCertificate(true)} className="bg-indigo-600 text-white px-8 py-4 rounded-2xl font-bold shadow-lg hover:bg-indigo-700">View Certificate</button><button onClick={() => setView('welcome')} className="bg-white border-2 border-slate-200 px-8 py-4 rounded-2xl font-bold hover:bg-slate-50">Back Home</button></div>
                                        </div>
                                    ) : (
                                        <div className="animate-in fade-in slide-in-from-bottom-8">
                                            <Certificate user={currentUser} courseTitle={currentCourse.title} />
                                            <div className="no-print mt-8 flex justify-center gap-4"><button onClick={() => window.print()} className="bg-slate-900 text-white px-8 py-3 rounded-xl font-bold flex items-center gap-2 hover:bg-slate-800"><Icon name="Printer" /> Print</button><button onClick={() => setShowCertificate(false)} className="text-slate-500 font-bold px-6 py-3">Back</button></div>
                                        </div>
                                    )}
                                </div>
                            ) : (
                                <div className="max-w-3xl mx-auto">
                                    <div className="mb-8"><span className="inline-block px-3 py-1 bg-slate-100 text-slate-600 rounded text-xs font-bold uppercase tracking-widest mb-4">{currentSlide.type === 'explanation' ? 'Concept Overview' : 'Assessment'}</span><h2 className="text-4xl font-extrabold text-slate-900 leading-tight">{currentSlide.title}</h2></div>
                                    {currentSlide.type === 'explanation' ? (
                                        <div className="space-y-6 text-slate-700 text-lg leading-relaxed animate-in fade-in duration-500">
                                            <p>{currentSlide.content}</p>
                                            <div className="bg-indigo-50 p-6 rounded-2xl border-l-4 border-indigo-600 flex items-center gap-4">
                                                <Icon name="Lightbulb" className="text-indigo-600" />
                                                <p className="text-indigo-900 italic font-medium">Concept learned! You can now proceed to the quiz.</p>
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="bg-slate-50 border border-slate-200 p-8 rounded-[32px] shadow-sm">
                                            <h3 className="text-xl font-bold mb-8 text-slate-800">{currentSlide.question}</h3>
                                            {currentSlide.type === 'mcq' && (
                                                <div className="space-y-3">{currentSlide.options.map((opt, idx) => (
                                                    <button key={idx} disabled={isSlideCleared(currentSlide.id)} onClick={() => handleAnswerCheck(idx)} className={`w-full text-left p-5 rounded-2xl border-2 transition-all flex items-center justify-between ${isSlideCleared(currentSlide.id) && idx === currentSlide.answer ? 'border-emerald-500 bg-emerald-50 text-emerald-800 font-bold' : 'border-white bg-white hover:border-indigo-200 hover:bg-slate-50'}`}>
                                                        <span className="font-semibold text-sm">{opt}</span>
                                                        {isSlideCleared(currentSlide.id) && idx === currentSlide.answer && <Icon name="CheckCircle2" className="text-emerald-500" />}
                                                    </button>
                                                ))}</div>
                                            )}
                                            {currentSlide.type === 'tf' && (
                                                <div className="flex gap-4">{[true, false].map((val) => (
                                                    <button key={val.toString()} disabled={isSlideCleared(currentSlide.id)} onClick={() => handleAnswerCheck(val)} className={`flex-1 p-6 rounded-2xl border-2 font-bold transition-all ${isSlideCleared(currentSlide.id) && val === currentSlide.answer ? 'border-emerald-500 bg-emerald-50 text-emerald-700' : 'border-white bg-white hover:border-indigo-200'}`}>{val ? 'TRUE' : 'FALSE'}</button>
                                                ))}</div>
                                            )}
                                            {currentSlide.type === 'fitb' && (
                                                <div className="relative">
                                                    <input type="text" placeholder="Type answer..." disabled={isSlideCleared(currentSlide.id)} className={`w-full p-5 rounded-2xl border-2 outline-none font-bold text-lg ${isSlideCleared(currentSlide.id) ? 'border-emerald-500 bg-emerald-50 text-emerald-900' : 'border-slate-200 focus:border-indigo-500 bg-white'}`} onKeyDown={(e) => e.key === 'Enter' && handleAnswerCheck(e.target.value)} />
                                                    {isSlideCleared(currentSlide.id) && <Icon name="CheckCircle2" className="absolute right-5 top-1/2 -translate-y-1/2 text-emerald-500" />}
                                                </div>
                                            )}
                                            {isSlideCleared(currentSlide.id) && (
                                                <div className="mt-8 p-6 rounded-2xl bg-emerald-50 text-emerald-800 border border-emerald-100 animate-in zoom-in-95"><div className="flex items-center gap-2 font-bold mb-2"><Icon name="Award" /> Correct!</div><p className="text-sm opacity-90">{currentSlide.explanation}</p></div>
                                            )}
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>
                        <footer className="no-print h-20 border-t bg-white px-8 flex items-center justify-between sticky bottom-0 z-10">
                            <button onClick={handlePrev} className="flex items-center gap-2 text-slate-500 hover:text-indigo-600 font-bold transition-all disabled:opacity-20" disabled={currentChapterIdx === 0 && currentSlideIdx === 0 && !courseCompleted}><Icon name="ChevronLeft" /> Prev</button>
                            <div className="flex items-center gap-1.5">{!courseCompleted && currentChapter.slides.map((s, idx) => <div key={idx} className={`h-1.5 rounded-full transition-all duration-300 ${idx === currentSlideIdx ? 'w-8 bg-indigo-600' : isSlideCleared(s.id) || s.type === 'explanation' ? 'w-2 bg-emerald-400' : 'w-2 bg-slate-200'}`} />)}</div>
                            {!courseCompleted && (
                                <button onClick={handleNext} className={`flex items-center gap-2 px-8 py-3 rounded-2xl font-extrabold transition-all shadow-lg ${isCurrentSlideCleared ? 'bg-indigo-600 text-white hover:bg-indigo-700 shadow-indigo-200' : 'bg-slate-100 text-slate-300 cursor-not-allowed shadow-none'}`}>
                                    {(currentSlideIdx === currentChapter.slides.length - 1 && currentChapterIdx === currentCourse.chapters.length - 1) ? 'Finish' : 'Next'} <Icon name="ChevronRight" />
                                </button>
                            )}
                        </footer>
                    </main>
                </div>
            );
        }
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
